Bootstrap: docker
From: ubuntu:22.04

%labels
    Author lcarretero
    Version 1.0

%environment
    # Put Poetry venv inside the project and on PATH
    export POETRY_VIRTUALENVS_IN_PROJECT=true
    export PATH="/opt/dsl-research-assistant/.venv/bin:${PATH}"

%files
    . /opt/dsl-research-assistant

%post
    # 1) Install system deps
    apt-get update && apt-get install -y --no-install-recommends \
        python3.10 python3.10-venv python3-pip curl git \
      && rm -rf /var/lib/apt/lists/*

    # 2) Install Poetry
    curl -sSL https://install.python-poetry.org | python3 -
    ln -s /root/.local/bin/poetry /usr/local/bin/poetry

    # 3) Install your Python deps
    cd /opt/dsl-research-assistant
    poetry config virtualenvs.in-project true
    poetry install --no-interaction --no-ansi

%runscript
    # whenever you 'singularity run ...',
    # drop into your project folder and exec python
    cd /opt/dsl-research-assistant
    exec python "$@"

%help
    This SIF bundles your DSL Research Assistant.
    • Run scripts:   singularity run dsl-research-assistant.sif script.py
    • Interactive:   singularity shell dsl-research-assistant.sif
      (you’ll start in /opt/dsl-research-assistant and have python/poetry ready)
